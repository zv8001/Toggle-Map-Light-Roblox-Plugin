-- # Made by z3ck200
-- # https://github.com/zv8001/Toggle-Map-Light-Roblox-Plugin/


local ChangeHistoryService = game:GetService("ChangeHistoryService")

local toolbar = plugin:CreateToolbar("Toggle Map Light")
local Toggle = toolbar:CreateButton("Toggle Map Light", "Toggle Map Light", "rbxassetid://15998247962")

local Selection = game:GetService("Selection")
local MapLightOn = false
local Changing = false

local Backup = nil

if not game.ServerStorage:FindFirstChild("ToggleMapLight_DO_NOT_REMOVE") then
	
	local Folder = Instance.new("Folder")
	Folder.Parent=game.ServerStorage
	Folder.Name="ToggleMapLight_DO_NOT_REMOVE"
	
	Toggled1 = Instance.new("BoolValue",Folder)
	Toggled1.Name = "Toggled"
	
	
	AmbientConfig = Instance.new("Color3Value",Folder)
	AmbientConfig.Name = "Ambient"
	
	OutdoorAmbientConfig = Instance.new("Color3Value",Folder)
	OutdoorAmbientConfig.Name = "OutdoorAmbient"
	
	ClockTime = Instance.new("NumberValue",Folder)
	ClockTime.Name = "ClockTime"
	
	ExposureCompensation = Instance.new("NumberValue",Folder)
	ExposureCompensation.Name = "ExposureCompensation"
	
	
	Configuration = Instance.new("Configuration",Folder)
	Configuration.Name = "# Auto-generated by https://create.roblox.com/store/asset/132769669114163/Toggle-Map-Light #"
	Configuration1 = Instance.new("Configuration",Configuration)
	Configuration1.Name = "# Plugin made by z3ck200 / ZV800 #"
end

local Folder = game.ServerStorage.ToggleMapLight_DO_NOT_REMOVE



local function Update()

	Folder.Ambient.Value = game.Lighting.Ambient
	Folder.OutdoorAmbient.Value = game.Lighting.OutdoorAmbient
	Folder.ClockTime.Value = game.Lighting.ClockTime
	Folder.ExposureCompensation.Value = game.Lighting.ExposureCompensation
	
end

if not Folder.Toggled.Value then
	Update()
end


Backup = Folder:Clone()

for i,v in pairs(Folder:GetChildren()) do
	v.Changed:Connect(function()
		Backup = Folder:Clone()
	end)
end

Toggle.ClickableWhenViewportHidden = true

local function ToggleLight(Value)
	if not Folder.Toggled.Value then
		Update()
		Folder.Toggled.Value = true
		Backup = Folder:Clone()
		
		Changing=true
		game.Lighting.Ambient=Color3.fromRGB(255, 255, 255)
		game.Lighting.OutdoorAmbient=Color3.fromRGB(121, 121, 121)
		game.Lighting.ClockTime=14.5
		game.Lighting.ExposureCompensation=0
		--game.Lighting.Brightnes=3
		task.delay(0.2,function()
			Changing=false
		end)
	else
		
		Folder.Toggled.Value=false
		Backup = Folder:Clone()
		game.Lighting.Ambient=Folder.Ambient.Value
		game.Lighting.OutdoorAmbient=Folder.OutdoorAmbient.Value
		game.Lighting.ClockTime=Folder.ClockTime.Value
		game.Lighting.ExposureCompensation=Folder.ExposureCompensation.Value
		--game.Lighting.Brightness=Brightness1
	end
end

--Restore If Broke


ShowWarning = function()
	local Warning = Instance.new("ScreenGui")
	local TextLabel = Instance.new("TextLabel")

	Warning.Name = "Warning"
	Warning.Parent = game.StarterGui
	Warning.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	TextLabel.Parent = Warning
	TextLabel.AnchorPoint = Vector2.new(0.5, 0.5)
	TextLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	TextLabel.BackgroundTransparency = 1.000
	TextLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
	TextLabel.BorderSizePixel = 0
	TextLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
	TextLabel.Size = UDim2.new(0, 200, 0, 50)
	TextLabel.Font = Enum.Font.SourceSans
	TextLabel.Text = "WARNING: DO NOT REMOVE THE ToggleMapLight_DO_NOT_REMOVE FOLDER.."
	TextLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
	TextLabel.TextSize = 34.000
	
	task.delay(4,function()
		Warning:Destroy()
	end)
end

task.spawn(function()
	while task.wait() do
		if not game.ServerStorage:FindFirstChild("ToggleMapLight_DO_NOT_REMOVE") then
			local BackupClone = Backup:Clone()
			if not game.ServerStorage:FindFirstChild("ToggleMapLight_DO_NOT_REMOVE") then
				BackupClone.Parent = game.ServerStorage
				Folder = game.ServerStorage.ToggleMapLight_DO_NOT_REMOVE
				ShowWarning()
			end
		
		end
	end
end)
	

Toggle.Click:Connect(ToggleLight)
